# 浏览器架构

-----

### 进程 VS 线程

线程不能单独存在，它是由进程来启动管理的。

一个进程就是一个程序的运行实例，是一个运行环境。

在进程中使用多线程并行处理能提升运算效率。

#### 进程与线程有以下4个特点

1. 进程中的任意线程出错，都会导致整个进程崩溃。
2. 线程之间共享进程中的数据。
3. 当一个进程关闭后，操作系统会回收所占用的内存，所以浏览器关闭后，内存回收由操作系统回收。
4. 进程之间的内容相互隔离，互不影响；进程之间通过IPC通信。          

### 单进程浏览器时代的问题

1. 不稳定
   一个插件的崩溃会导致整个浏览器的崩溃。
2. 不流畅
   易阻塞
3. 不安全
   插件可以获取系统资源

### 目前的多进程架构

![img](https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png)

<center>浏览器多进程架构</center>

1. 浏览器进程：
   负责界面显示，用户交互，子进程管理，存储。

2. 渲染进程：
   将HTML、CSS、JavaScript 转换为用户可与之交互的网页。

   排版引擎 Blink 和 Javascript引擎 V8都是运行在该进程中。

3. GPU 进程： UI界面绘制。

4. 网络进程  ： 网络资源加载。

5. 插件进程  ： 由于插件容易崩溃，所有单独一个进程。

### 多进程架构的问题

1. 资源占用高
2. 架构复杂，没有太大的改善空间了

### 未来

面向服务的架构（SOA）

### 扩展

单个页面崩溃，为何整个站点都崩溃了？

Chrome每一个标签对应一个渲染进程，但如果打开一个新页面，而新页面和当前页面属于同一站点时（根域名相同），那么新页面就会复用父页面的渲染进程，这个策略叫 PPSI

为什么要让同一站点的页面跑在一个渲染进程里面呢？

因为同一个渲染进程，可以共享JS的执行环境，A页面可以在B页面中执行脚本。

Chrome输出的实际上是图片

UserAgent 是浏览器的身份证，为了让服务器知道浏览器的基础信息，然后服务器根据不同的UA返回不同的内容，比如手机上返回手机的样式，PC上返回PC的样式。